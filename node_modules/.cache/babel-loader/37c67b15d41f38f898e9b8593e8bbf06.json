{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Ang Kai Yang/Desktop/portfolio/node_modules/@babel/runtime/regenerator\";import _createForOfIteratorHelper from\"C:/Users/Ang Kai Yang/Desktop/portfolio/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _slicedToArray from\"C:/Users/Ang Kai Yang/Desktop/portfolio/node_modules/@babel/runtime/helpers/esm/slicedToArray\";var _marked=/*#__PURE__*/_regeneratorRuntime.mark(expandSpan),_marked2=/*#__PURE__*/_regeneratorRuntime.mark(expandRanges);import Level from'../Level.js';import{createBackgroundLayer,createSpriteLayer}from'../layers.js';import{loadJSON,loadSpriteSheet}from'../loaders.js';import{Matrix}from'../math.js';export function loadLevel(name){return loadJSON(\"./levels/\".concat(name,\".json\")).then(function(levelSpec){return Promise.all([levelSpec,loadSpriteSheet(levelSpec.spriteSheet)]);}).then(function(_ref){var _ref2=_slicedToArray(_ref,2),levelSpec=_ref2[0],sprites=_ref2[1];var level=new Level();var mergedTiles=levelSpec.layers.reduce(function(mergedTiles,layerSpec){return mergedTiles.concat(layerSpec.tiles);},[]);var collisionGrid=createCollisionGrid(mergedTiles,levelSpec.patterns);level.setCollisionGrid(collisionGrid);levelSpec.layers.forEach(function(layer){var backgroundGrid=createBackgroundGrid(layer.tiles,levelSpec.patterns);var backgroundLayer=createBackgroundLayer(level,backgroundGrid,sprites);level.comp.layers.push(backgroundLayer);});var spriteLayer=createSpriteLayer(level.entities);level.comp.layers.push(spriteLayer);return level;});}function createCollisionGrid(tiles,patterns){var grid=new Matrix();var _iterator=_createForOfIteratorHelper(expandTiles(tiles,patterns)),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var _step$value=_step.value,tile=_step$value.tile,x=_step$value.x,y=_step$value.y;grid.set(x,y,{type:tile.type});}}catch(err){_iterator.e(err);}finally{_iterator.f();}return grid;}function createBackgroundGrid(tiles,patterns){var grid=new Matrix();var _iterator2=_createForOfIteratorHelper(expandTiles(tiles,patterns)),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var _step2$value=_step2.value,tile=_step2$value.tile,x=_step2$value.x,y=_step2$value.y;grid.set(x,y,{name:tile.name});}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}return grid;}function expandSpan(xStart,xLen,yStart,yLen){var xEnd,yEnd,x,y;return _regeneratorRuntime.wrap(function expandSpan$(_context){while(1){switch(_context.prev=_context.next){case 0:xEnd=xStart+xLen;yEnd=yStart+yLen;x=xStart;case 3:if(!(x<xEnd)){_context.next=14;break;}y=yStart;case 5:if(!(y<yEnd)){_context.next=11;break;}_context.next=8;return{x:x,y:y};case 8:++y;_context.next=5;break;case 11:++x;_context.next=3;break;case 14:case\"end\":return _context.stop();}}},_marked);}function expandRange(range){if(range.length===4){var _range=_slicedToArray(range,4),xStart=_range[0],xLen=_range[1],yStart=_range[2],yLen=_range[3];return expandSpan(xStart,xLen,yStart,yLen);}else if(range.length===3){var _range2=_slicedToArray(range,3),_xStart=_range2[0],_xLen=_range2[1],_yStart=_range2[2];return expandSpan(_xStart,_xLen,_yStart,1);}else if(range.length===2){var _range3=_slicedToArray(range,2),_xStart2=_range3[0],_yStart2=_range3[1];return expandSpan(_xStart2,1,_yStart2,1);}}function expandRanges(ranges){var _iterator3,_step3,range,_iterator4,_step4,item;return _regeneratorRuntime.wrap(function expandRanges$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_iterator3=_createForOfIteratorHelper(ranges);_context2.prev=1;_iterator3.s();case 3:if((_step3=_iterator3.n()).done){_context2.next=24;break;}range=_step3.value;_iterator4=_createForOfIteratorHelper(expandRange(range));_context2.prev=6;_iterator4.s();case 8:if((_step4=_iterator4.n()).done){_context2.next=14;break;}item=_step4.value;_context2.next=12;return item;case 12:_context2.next=8;break;case 14:_context2.next=19;break;case 16:_context2.prev=16;_context2.t0=_context2[\"catch\"](6);_iterator4.e(_context2.t0);case 19:_context2.prev=19;_iterator4.f();return _context2.finish(19);case 22:_context2.next=3;break;case 24:_context2.next=29;break;case 26:_context2.prev=26;_context2.t1=_context2[\"catch\"](1);_iterator3.e(_context2.t1);case 29:_context2.prev=29;_iterator3.f();return _context2.finish(29);case 32:case\"end\":return _context2.stop();}}},_marked2,null,[[1,26,29,32],[6,16,19,22]]);}function expandTiles(tiles,patterns){var expandedTiles=[];function walkTiles(tiles,offsetX,offsetY){var _iterator5=_createForOfIteratorHelper(tiles),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var tile=_step5.value;var _iterator6=_createForOfIteratorHelper(expandRanges(tile.ranges)),_step6;try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var _step6$value=_step6.value,x=_step6$value.x,y=_step6$value.y;var derivedX=x+offsetX;var derivedY=y+offsetY;if(tile.pattern){var _tiles=patterns[tile.pattern].tiles;walkTiles(_tiles,derivedX,derivedY);}else{expandedTiles.push({tile:tile,x:derivedX,y:derivedY});}}}catch(err){_iterator6.e(err);}finally{_iterator6.f();}}}catch(err){_iterator5.e(err);}finally{_iterator5.f();}}walkTiles(tiles,0,0);return expandedTiles;}","map":{"version":3,"sources":["C:/Users/Ang Kai Yang/Desktop/portfolio/src/js/loaders/level.js"],"names":["expandSpan","expandRanges","Level","createBackgroundLayer","createSpriteLayer","loadJSON","loadSpriteSheet","Matrix","loadLevel","name","then","levelSpec","Promise","all","spriteSheet","sprites","level","mergedTiles","layers","reduce","layerSpec","concat","tiles","collisionGrid","createCollisionGrid","patterns","setCollisionGrid","forEach","layer","backgroundGrid","createBackgroundGrid","backgroundLayer","comp","push","spriteLayer","entities","grid","expandTiles","tile","x","y","set","type","xStart","xLen","yStart","yLen","xEnd","yEnd","expandRange","range","length","ranges","item","expandedTiles","walkTiles","offsetX","offsetY","derivedX","derivedY","pattern"],"mappings":"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","sourcesContent":["import Level from '../Level.js';\r\nimport {createBackgroundLayer, createSpriteLayer} from '../layers.js';\r\nimport {loadJSON, loadSpriteSheet} from '../loaders.js';\r\nimport {Matrix} from '../math.js';\r\n\r\nexport function loadLevel(name){\r\n\treturn loadJSON(`./levels/${name}.json`)\r\n\t.then(levelSpec => Promise.all([\r\n\t\tlevelSpec,\r\n\t\tloadSpriteSheet(levelSpec.spriteSheet),\r\n\t]))\r\n\t.then(([levelSpec,sprites])=>{\r\n\t\tconst level = new Level();\r\n\r\n\t\tconst mergedTiles=levelSpec.layers.reduce((mergedTiles,layerSpec)=>{\r\n\t\t\treturn mergedTiles.concat(layerSpec.tiles);\r\n\t\t}, []);\r\n\t\tconst collisionGrid=createCollisionGrid(mergedTiles,levelSpec.patterns)\r\n\t\tlevel.setCollisionGrid(collisionGrid);\r\n\r\n\t\tlevelSpec.layers.forEach(layer=>{\r\n\t\tconst backgroundGrid=createBackgroundGrid(layer.tiles,levelSpec.patterns)\r\n \t\tconst backgroundLayer=createBackgroundLayer(level,backgroundGrid, sprites);\r\n \t\tlevel.comp.layers.push(backgroundLayer);\r\n \t\t});\r\n\r\n \t\tconst spriteLayer=createSpriteLayer(level.entities);\r\n \t\tlevel.comp.layers.push(spriteLayer);\r\n\r\n \t\treturn level;\r\n\t})\r\n}\r\n\r\nfunction createCollisionGrid(tiles,patterns){\r\n\tconst grid=new Matrix();\r\n\r\n\tfor (const {tile,x,y} of expandTiles(tiles,patterns)){\r\n\t\t\tgrid.set(x,y,{type:tile.type});\r\n\t\t}\r\n\r\n\t\treturn grid;\r\n}\r\n\r\nfunction createBackgroundGrid(tiles,patterns){\r\n\tconst grid=new Matrix();\r\n\r\n\tfor (const {tile,x,y} of expandTiles(tiles,patterns)){\r\n\t\t\tgrid.set(x,y,{name:tile.name});\r\n\t\t}\r\n\r\n\t\treturn grid;\r\n}\r\n\r\nfunction* expandSpan(xStart,xLen,yStart,yLen){\r\n\tconst xEnd=xStart+xLen;\r\n\tconst yEnd=yStart+yLen;\r\n\tfor (let x=xStart;x<xEnd;++x){\r\n\t\tfor (let y=yStart;y<yEnd;++y){\r\n\t\t\tyield {x,y};\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction expandRange(range){\r\n\tif (range.length===4){\r\n\t\tconst [xStart,xLen,yStart,yLen]=range;\r\n\t\treturn expandSpan(xStart,xLen,yStart,yLen);\r\n\t}\r\n\r\n\telse if (range.length===3){\r\n\t\tconst [xStart,xLen,yStart]=range;\r\n\t\treturn expandSpan(xStart,xLen,yStart,1);\r\n\t}\r\n\r\n\telse if (range.length===2){\r\n\t\tconst [xStart,yStart]=range;\r\n\t\treturn expandSpan(xStart,1,yStart,1);\r\n\t}\r\n}\r\n\r\nfunction* expandRanges(ranges){\r\n\tfor (const range of ranges){\r\n\t\tfor (const item of expandRange(range)){\r\n\t\t\tyield item;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction expandTiles(tiles,patterns){\r\n\tconst expandedTiles =[];\r\n\r\n\tfunction walkTiles(tiles,offsetX,offsetY){\r\n\t\tfor (const tile of tiles){\r\n\t\t\tfor (const {x,y} of expandRanges(tile.ranges)){\r\n\t\t\t\tconst derivedX=x+offsetX;\r\n\t\t\t\tconst derivedY=y+offsetY;\r\n\r\n\t\t\t\tif (tile.pattern){\r\n\t\t\t\t\t\tconst tiles=patterns[tile.pattern].tiles;\r\n\t\t\t\t\t\twalkTiles(tiles,derivedX,derivedY);\r\n\t\t\t\t\t} else{\r\n\t\t\t\t\t\texpandedTiles.push({\r\n\t\t\t\t\t\t\ttile,\r\n\t\t\t\t\t\t\tx:derivedX,\r\n\t\t\t\t\t\t\ty:derivedY,\r\n\t\t\t\t\t\t}); \r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\twalkTiles(tiles,0,0);\r\n\r\n\treturn expandedTiles;\r\n}\r\n"]},"metadata":{},"sourceType":"module"}